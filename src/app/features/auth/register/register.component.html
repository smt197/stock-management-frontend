<div class="register-container">
  <div class="register-card-wrapper">
    <mat-card class="register-card">
      <mat-card-header>
        <div class="header-content">
          <mat-icon class="register-icon">person_add</mat-icon>
          <mat-card-title>Créer un compte</mat-card-title>
          <mat-card-subtitle>Remplissez le formulaire pour vous inscrire</mat-card-subtitle>
        </div>
      </mat-card-header>

      <mat-card-content>
        <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="register-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Nom complet</mat-label>
            <input matInput
                   type="text"
                   formControlName="name"
                   placeholder="Jean Dupont"
                   autocomplete="name">
            <mat-icon matPrefix>person</mat-icon>
            <mat-error *ngIf="registerForm.get('name')?.hasError('required')">
              Le nom est requis
            </mat-error>
            <mat-error *ngIf="registerForm.get('name')?.hasError('maxlength')">
              Le nom est trop long (max 255 caractères)
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Email</mat-label>
            <input matInput
                   type="email"
                   formControlName="email"
                   placeholder="exemple@email.com"
                   autocomplete="email">
            <mat-icon matPrefix>email</mat-icon>
            <mat-error *ngIf="registerForm.get('email')?.hasError('required')">
              L'email est requis
            </mat-error>
            <mat-error *ngIf="registerForm.get('email')?.hasError('email')">
              Email invalide
            </mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Mot de passe</mat-label>
            <input matInput
                   [type]="hidePassword() ? 'password' : 'text'"
                   formControlName="password"
                   placeholder="Minimum 8 caractères"
                   autocomplete="new-password">
            <mat-icon matPrefix>lock</mat-icon>
            <button mat-icon-button
                    matSuffix
                    type="button"
                    (click)="hidePassword.set(!hidePassword())"
                    [attr.aria-label]="'Hide password'"
                    [attr.aria-pressed]="!hidePassword()">
              <mat-icon>{{ hidePassword() ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error *ngIf="registerForm.get('password')?.hasError('required')">
              Le mot de passe est requis
            </mat-error>
            <mat-error *ngIf="registerForm.get('password')?.hasError('minlength')">
              Minimum 8 caractères requis
            </mat-error>
            <mat-hint>Utilisez au moins 8 caractères avec majuscules, minuscules, chiffres et symboles</mat-hint>
          </mat-form-field>

          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Confirmer le mot de passe</mat-label>
            <input matInput
                   [type]="hidePasswordConfirmation() ? 'password' : 'text'"
                   formControlName="password_confirmation"
                   placeholder="Retapez votre mot de passe"
                   autocomplete="new-password">
            <mat-icon matPrefix>lock_outline</mat-icon>
            <button mat-icon-button
                    matSuffix
                    type="button"
                    (click)="hidePasswordConfirmation.set(!hidePasswordConfirmation())"
                    [attr.aria-label]="'Hide password confirmation'"
                    [attr.aria-pressed]="!hidePasswordConfirmation()">
              <mat-icon>{{ hidePasswordConfirmation() ? 'visibility_off' : 'visibility' }}</mat-icon>
            </button>
            <mat-error *ngIf="registerForm.get('password_confirmation')?.hasError('required')">
              Veuillez confirmer votre mot de passe
            </mat-error>
            <mat-error *ngIf="registerForm.get('password_confirmation')?.hasError('passwordMismatch')">
              Les mots de passe ne correspondent pas
            </mat-error>
          </mat-form-field>

          <button mat-raised-button
                  color="primary"
                  type="submit"
                  class="submit-button full-width"
                  [disabled]="registerForm.invalid || loading()">
            @if (loading()) {
              <mat-spinner diameter="20"></mat-spinner>
              <span>Inscription en cours...</span>
            } @else {
              <ng-container>
                <mat-icon>person_add</mat-icon>
                <span>S'inscrire</span>
              </ng-container>
            }
          </button>
        </form>

        <div class="register-footer">
          <p>Vous avez déjà un compte ?</p>
          <a mat-button routerLink="/login" color="primary">
            <mat-icon>login</mat-icon>
            Se connecter
          </a>
        </div>
      </mat-card-content>
    </mat-card>
  </div>
</div>
